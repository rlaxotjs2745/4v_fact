<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.fact.core.model.WebMainPopupMapper">

    <select id="getWebMainPopupCount" resultType="int">
        SELECT COUNT (*) FROM TB_WEB_MAIN_POPUP
        WHERE IS_SHOW = 1 OR IS_SHOW = 9
    </select>

    <select id="getWebMainPopupList" resultType="kr.or.fact.core.model.DTO.WebMainPopupVO">
        SELECT
            IDX_POPUP_IMG,
            SUBJECT,
            CONTENTS_TYPE,
            POPUP_URL,
            STARTDATE,
            ENDDATE,
            IS_SHOW,
            REG_DATE,
            ADMIN_NAME,
            LAST_UPD_DATE,
            IDX_FILE_INFO,
            FILE_PATH
        FROM (
                 SELECT ROW_NUMBER() OVER(ORDER by #{order_field} DESC) AS row_num
                ,IDX_POPUP_IMG,
                        SUBJECT,
                        CONTENTS_TYPE,
                        POPUP_URL,
                        STARTDATE,
                        ENDDATE,
                        IS_SHOW,
                        REG_DATE,
                        ADMIN_NAME,
                        LAST_UPD_DATE,
                        IDX_FILE_INFO,
                        FILE_PATH
                 FROM (
                          SELECT A.*, B.admin_name, C.FILE_PATH FROM TB_WEB_MAIN_POPUP A
                                        INNER JOIN TB_ADMIN B ON A.idx_admin = B.idx_admin
                                        INNER JOIN TB_FILE_INFO C ON A.IDX_FILE_INFO = C.IDX_FILE_INFO
                          WHERE IS_SHOW = 1 OR IS_SHOW = 9
                            AND C.FILE_TYPE = 6
                          order by IDX_POPUP_IMG desc
                      )
                 WHERE ROWNUM <![CDATA[<=]]> #{page_num}*#{amount}
             )
        WHERE row_num <![CDATA[>]]> (#{page_num} -1)*#{amount}
    </select>

    <insert id="insertPopupContent" parameterType="kr.or.fact.core.model.DTO.WebMainPopupVO">
        INSERT INTO TB_WEB_MAIN_POPUP( IDX_POPUP_IMG,
                                      SUBJECT,
                                      CONTENTS_TYPE,
                                      POPUP_URL,
                                      STARTDATE,
                                      ENDDATE,
                                      IS_SHOW,
                                      REG_DATE,
                                      IDX_ADMIN,
                                      LAST_UPD_DATE,
                                      IDX_FILE_INFO)
        VALUES (SEQ_WEB_MAIN_POPUP.NEXTVAL,
                #{subject},
                #{content_type},
                #{popup_url},
                TO_DATE(#{startDate},'YYYY-MM-DD HH24-MI-SS'),
                TO_DATE(#{endDate},'YYYY-MM-DD HH24-MI-SS'),
                #{is_show},
                SYSDATE,
                #{idx_admin},
                SYSDATE,
                #{idx_file_info}
               )
    </insert>
</mapper>

